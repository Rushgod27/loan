import { auth, db } from "./js/firebase.js";

import {
  signInWithEmailAndPassword,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
  doc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


window.loginUser = async ()=>{
  try{
    await signInWithEmailAndPassword(
      auth,
      loginEmail.value.trim(),
      loginPassword.value.trim()
    );
  }catch(err){
    alert(err.message);
  }
};

onAuthStateChanged(auth, async(user)=>{
  if(!user) return;

  try{
    const snap = await getDoc(
      doc(db,"users",user.uid)
    );

    if(!snap.exists()){
      alert("User role not assigned.");
      return;
    }

    const role = snap.data().role;

    // ðŸ”¥ ROLE BASED REDIRECT
    if(role === "boss"){
      location.href = "boss-dashboard.html";
    }
    else if(role === "owner"){
      location.href = "owner-dashboard.html";
    }
    else if(role === "agent"){
      location.href = "dashboard.html";
    }
    else{
      alert("Unknown role");
    }

  }catch(err){
    alert("Error loading role: " + err.message);
  }
});
